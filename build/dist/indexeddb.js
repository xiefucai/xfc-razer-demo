var v=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function p(h,l,c){return c={path:l,exports:{},require:function(f,a){return P(f,a==null?c.path:a)}},h(c,c.exports),c.exports}function P(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}var E=p(function(h,l){l.__esModule=!0;var c=function(){function a(r,o,t){this.table=o,this.tx=r.transaction(o,t)}return a.prototype.add=function(r){var o=this;return new Promise(function(t,s){var i=o.tx.objectStore(o.table),e=[];Array.isArray(r)?r.forEach(function(u){e.push(i.add(u))}):e.push(i.add(r)),o.tx.oncomplete=function(){Array.isArray(r)?t(e.map(function(u){return u.result})):t(e[0].result)},o.tx.onerror=function(){this.error&&s(this.error)}})},a}(),f=function(){function a(r){this.db=null,this.db_name="",this.db_name=r}return a.prototype.open=function(r){var o=this,t=this;return new Promise(function(s,i){var e=window.indexedDB.open(o.db_name,r.version);e.onsuccess=function(u){t.db=e.result,s(t.db)},e.onupgradeneeded=function(u){var b=u.target.result;b.onerror=function(n){i(n)},t.db=b,r.objectStores.forEach(function(n){var d=b.createObjectStore(n.name,{keyPath:n.keyPath,autoIncrement:n.autoIncrement});n.indexes.forEach(function(y){var D=y.name,_=y.keyPath,I=y.multiEntry,g=y.unique;d.createIndex(D,_,{unique:g,multiEntry:I})})});var m=u.target.transaction;m&&(m.oncomplete=function(){s(b)})}})},a.prototype.choose=function(r,o){if(this.db)return new c(this.db,r,o);throw new Error("db is not opened")},a}();l.default=f}),j=p(function(h,l){l.__esModule=!0;var c=function(){function f(){var a=this;this.list={},this.on=function(r,o){if(a.list[r]){if(a.list[r].includes(o))return;a.list[r].push(o)}else a.list[r]=[o]},this.publish=function(r){for(var o=[],t=1;t<arguments.length;t++)o[t-1]=arguments[t];Array.isArray(a.list[r])&&a.list[r].forEach(function(s){s.apply(void 0,o)})}}return f}();l.default=c}),A=p(function(h,l){var c=v&&v.__awaiter||function(r,o,t,s){function i(e){return e instanceof t?e:new t(function(u){u(e)})}return new(t||(t=Promise))(function(e,u){function b(d){try{n(s.next(d))}catch(y){u(y)}}function m(d){try{n(s.throw(d))}catch(y){u(y)}}function n(d){d.done?e(d.value):i(d.value).then(b,m)}n((s=s.apply(r,o||[])).next())})},f=v&&v.__generator||function(r,o){var t={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},s,i,e,u;return u={next:b(0),throw:b(1),return:b(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function b(n){return function(d){return m([n,d])}}function m(n){if(s)throw new TypeError("Generator is already executing.");for(;t;)try{if(s=1,i&&(e=n[0]&2?i.return:n[0]?i.throw||((e=i.return)&&e.call(i),0):i.next)&&!(e=e.call(i,n[1])).done)return e;switch(i=0,e&&(n=[n[0]&2,e.value]),n[0]){case 0:case 1:e=n;break;case 4:return t.label++,{value:n[1],done:!1};case 5:t.label++,i=n[1],n=[0];continue;case 7:n=t.ops.pop(),t.trys.pop();continue;default:if(e=t.trys,!(e=e.length>0&&e[e.length-1])&&(n[0]===6||n[0]===2)){t=0;continue}if(n[0]===3&&(!e||n[1]>e[0]&&n[1]<e[3])){t.label=n[1];break}if(n[0]===6&&t.label<e[1]){t.label=e[1],e=n;break}if(e&&t.label<e[2]){t.label=e[2],t.ops.push(n);break}e[2]&&t.ops.pop(),t.trys.pop();continue}n=o.call(r,t)}catch(d){n=[6,d],i=0}finally{s=e=0}if(n[0]&5)throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}};l.__esModule=!0;var a=function(){function r(){this.state=0,this.controller=new AbortController,this.unlock=null,this.puber=new j.default}return r.prototype.lock=function(o,t){return c(this,void 0,void 0,function(){var s=this;return f(this,function(i){switch(i.label){case 0:if(typeof navigator.locks=="undefined")throw new Error("Your browser does not support Web Locks API.");return[4,navigator.locks.request(o,{signal:this.controller.signal},function(e){return c(s,void 0,void 0,function(){return f(this,function(u){switch(u.label){case 0:return this.puber.publish("locked"),[4,t()];case 1:return u.sent(),this.puber.publish("unlocked"),console.log("unlocked",e),[2]}})})})];case 1:return[2,i.sent()]}})})},r.prototype.stealLock=function(o,t){return c(this,void 0,void 0,function(){var s=this;return f(this,function(i){switch(i.label){case 0:if(typeof navigator.locks=="undefined")throw new Error("Your browser does not support Web Locks API.");return[4,navigator.locks.request(o,{steal:!0},function(e){return c(s,void 0,void 0,function(){return f(this,function(u){switch(u.label){case 0:return this.puber.publish("locked"),[4,t()];case 1:return u.sent(),this.puber.publish("unlocked"),[2]}})})})];case 1:return[2,i.sent()]}})})},r.prototype.query=function(){return c(this,void 0,void 0,function(){return f(this,function(o){switch(o.label){case 0:return[4,navigator.locks.query()];case 1:return[2,o.sent()]}})})},r.prototype.unLock=function(){return c(this,void 0,void 0,function(){return f(this,function(o){return this.controller.abort(),[2]})})},r}();l.default=a}),w=p(function(h,l){l.__esModule=!0,l.ADBObjectStore=l.LockHolder=void 0,l.ADBObjectStore=E.default,l.LockHolder=A.default}),k=w.ADBObjectStore,x=w.LockHolder;var S=async()=>{let h=new k("usb_devices"),l=await h.open({version:1,objectStores:[{name:"usb",keyPath:["VID","PID"],autoIncrement:!1,indexes:[{name:"by_vendor_id",keyPath:"VID",multiEntry:!1,unique:!1},{name:"by_product_id",keyPath:"PID",multiEntry:!1,unique:!1},{name:"by_type",keyPath:"type",multiEntry:!1,unique:!1}]}]});{let f=await h.choose("usb","readwrite").add([{VID:5426,PID:201,type:"mouse",device_name:"Razer Basilisk Essential"},{VID:5426,PID:379,type:"keyboard",device_name:"Razer Huntsman Tournament Edition"},{VID:5426,PID:479,type:"keyboard",device_name:"Razer Huntsman Tournament Edition"},{VID:5426,PID:579,type:"keyboard",device_name:"Razer Huntsman Tournament Edition"},{VID:5426,PID:1e3,type:"keyboard",device_name:"Razer Huntsman Tournament Edition"},{VID:6426,PID:108,type:"keyboard",device_name:"Razer Huntsman Tournament Edition"},{VID:6426,PID:579,type:"keyboard",device_name:"Razer Huntsman Tournament Edition"},{VID:6426,PID:888,type:"keyboard",device_name:"Razer Huntsman Tournament Edition"}]);console.log("results",f)}{let f=await h.choose("usb","readwrite").add({VID:8899,PID:777,type:"mouse aaa",device_name:"ooxx"});console.log("result",f)}};S().catch(h=>{console.warn("err",h)});
//# sourceMappingURL=indexeddb.js.map
